# Current date: {{ .CurrentDate.Format "Mon Jan _2 15:04:05 2006" }}
# Hostname: {{ .Hostname }}
# Files: {{ .Filename }}
{{ with .Global -}}
# Overall: {{ short .TotalQueries }} total, {{ short .UniqueQueries }} unique
# Attribute          total     min     max     avg     95%  median
# ============     ======= ======= ======= ======= ======= =======
{{ with .Metrics -}}
{{ with .TimeMetrics -}}
# Exec time        {{ shortTime .Query_time.Sum }} {{ shortTime .Query_time.Min }} {{ shortTime .Query_time.Max }} {{ shortTime .Query_time.Avg }} {{ shortTime .Query_time.P95 }} {{ shortTime .Query_time.Med }}
# Lock time        {{ shortTime .Lock_time.Sum }} {{ shortTime .Lock_time.Min }} {{ shortTime .Lock_time.Max }} {{ shortTime .Lock_time.Avg }} {{ shortTime .Lock_time.P95 }} {{ shortTime .Lock_time.Med }}
{{ end -}}
{{ with .NumberMetrics -}}
# Rows sent        {{ short .Rows_sent.Sum }} {{ short .Rows_sent.Min }} {{ short .Rows_sent.Max }} {{ short .Rows_sent.Avg }} {{ short .Rows_sent.P95 }} {{ short .Rows_sent.Med }}
# Rows examine     {{ short .Rows_examined.Sum }} {{ short .Rows_examined.Min }} {{ short .Rows_examined.Max }} {{ short .Rows_examined.Avg }} {{ short .Rows_examined.P95 }} {{ short .Rows_examined.Med }}
# Rows affecte     {{ short .Rows_affected.Sum }} {{ short .Rows_affected.Min }} {{ short .Rows_affected.Max }} {{ short .Rows_affected.Avg }} {{ short .Rows_affected.P95 }} {{ short .Rows_affected.Med }}
# Bytes sent       {{ shortByte .Bytes_sent.Sum }} {{ shortByte .Bytes_sent.Min }} {{ shortByte .Bytes_sent.Max }} {{ shortByte .Bytes_sent.Avg }} {{ shortByte .Bytes_sent.P95 }} {{ shortByte .Bytes_sent.Med }}
{{ end -}}
{{ end -}}
{{ end -}}
{{ $g := .Global }}
# Profile
# Rank Query ID           Response time Calls  R/Call
# ==== ================== ============= ====== ======
{{ range $i, $v := .Profiles }}{{ with $v.Class -}}
# {{ rank $i | printf "%4d" }} 0x{{ .Id }} {{ printf "%7.4f" .Metrics.TimeMetrics.Query_time.Sum }} {{ percent .Metrics.TimeMetrics.Query_time.Sum $g.Metrics.TimeMetrics.Query_time.Sum | printf "%4.1f%%" }} {{ printf "%6d" .TotalQueries }} {{ per .Metrics.TimeMetrics.Query_time.Sum .TotalQueries | printf "%6.4f" }} {{ summary .Example.Query }}
{{ end }}{{ end -}}
{{ range $i, $v := .Profiles }}{{ with $v.Class }}
# Query {{ rank $i }}: ID 0x{{ .Id }}
# Attribute    pct   total     min     max     avg     95%  median
# ============ === ======= ======= ======= ======= ======= =======
# Count        {{ percent .TotalQueries $g.TotalQueries | printf "%3.0f" }} {{ printf "%7d" .TotalQueries }}
{{ with .Metrics.TimeMetrics -}}
# Exec time    {{ percent .Query_time.Sum $g.Metrics.TimeMetrics.Query_time.Sum | printf "%3.0f" }} {{ shortTime .Query_time.Sum }} {{ shortTime .Query_time.Min }} {{ shortTime .Query_time.Max }} {{ shortTime .Query_time.Avg }} {{ shortTime .Query_time.P95 }} {{ shortTime .Query_time.Med }}
# Lock time    {{ percent .Lock_time.Sum $g.Metrics.TimeMetrics.Lock_time.Sum | printf "%3.0f" }} {{ shortTime .Lock_time.Sum }} {{ shortTime .Lock_time.Min }} {{ shortTime .Lock_time.Max }} {{ shortTime .Lock_time.Avg }} {{ shortTime .Lock_time.P95 }} {{ shortTime .Lock_time.Med }}
{{ end -}}
{{ with .Metrics.NumberMetrics -}}
# Rows sent    {{ percent .Rows_sent.Sum $g.Metrics.NumberMetrics.Rows_sent.Sum | printf "%3.0f" }} {{ short .Rows_sent.Sum }} {{ short .Rows_sent.Min }} {{ short .Rows_sent.Max }} {{ short .Rows_sent.Avg }} {{ short .Rows_sent.P95 }} {{ short .Rows_sent.Med }}
# Rows examine {{ percent .Rows_examined.Sum $g.Metrics.NumberMetrics.Rows_examined.Sum | printf "%3.0f" }} {{ short .Rows_examined.Sum }} {{ short .Rows_examined.Min }} {{ short .Rows_examined.Max }} {{ short .Rows_examined.Avg }} {{ short .Rows_examined.P95 }} {{ short .Rows_examined.Med }}
# Rows affecte {{ percent .Rows_affected.Sum $g.Metrics.NumberMetrics.Rows_affected.Sum | printf "%3.0f" }} {{ short .Rows_affected.Sum }} {{ short .Rows_affected.Min }} {{ short .Rows_affected.Max }} {{ short .Rows_affected.Avg }} {{ short .Rows_affected.P95 }} {{ short .Rows_affected.Med }}
# Bytes sent   {{ percent .Bytes_sent.Sum $g.Metrics.NumberMetrics.Bytes_sent.Sum | printf "%3.0f" }} {{ shortByte .Bytes_sent.Sum }} {{ shortByte .Bytes_sent.Min }} {{ shortByte .Bytes_sent.Max }} {{ shortByte .Bytes_sent.Avg }} {{ shortByte .Bytes_sent.P95 }} {{ shortByte .Bytes_sent.Med }}
{{ end -}}
# String:
# Databases    {{ .Example.Db }}
# 
# EXPLAIN /*!50100 PARTITIONS*/
{{ .Example.Query }}\G
{{ end }}{{ end -}}
